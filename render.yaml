services:
  # Frontend Service (React/Vite)
  - type: web
    name: socialflow-frontend
    env: static
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    envVars:
      - key: VITE_API_URL
        value: https://socialflow-backend.onrender.com
      - key: VITE_APP_URL
        value: https://socialflow-frontend.onrender.com

  # Backend API Service
  - type: web
    name: socialflow-backend
    env: node
    rootDir: backend
    buildCommand: npm install && npx prisma generate
    startCommand: npx prisma migrate deploy && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: JWT_SECRET
        value: LEv5DmQSg0L9gz6B2wtFW9HcTmL8VwAtU82r8l9ky5lQm9t41TfhQJm3bBFPuTSO4KX2QegqOJxnTLcRlWjugcoZsTeRu0OaRhwMRYsdyfnxP
      - key: CLIENT_URL
        value: https://socialflow-frontend.onrender.com
      - key: DATABASE_URL
        value: "" # Add your Neon PostgreSQL connection string here
      - key: HF_TOKEN
        value: "" # Add your Hugging Face token
      - key: OPENAI_API_KEY
        value: "" # Add your OpenAI API key
      - key: CLOUDINARY_CLOUD_NAME
        value: didphkw9a
      - key: CLOUDINARY_API_KEY
        value: 455665947111787
      - key: CLOUDINARY_API_SECRET
        value: "" # Add your Cloudinary API secret
      - key: FACEBOOK_APP_ID
        value: 1651763742686740
      - key: FACEBOOK_APP_SECRET
        value: "" # Add your Facebook app secret
      - key: INSTAGRAM_REDIRECT_URI
        value: https://socialflow-backend.onrender.com/api/instagram/oauth/callback
# INSTAGRAM_ACCESS_TOKEN removed - using per-user tokens from database instead

# Using external Neon PostgreSQL database - no need for built-in database

# ðŸ“‹ COMPLETE DEPLOYMENT GUIDE (FREE PLAN):
#
# ðŸŽ¯ STEP 1: CREATE FREE DATABASE (2 minutes)
#    - Go to https://console.neon.tech
#    - Sign up (free) â†’ Create project "socialflow"
#    - Copy PostgreSQL connection string (starts with postgresql://)
#
# ðŸŽ¯ STEP 2: DEPLOY ON RENDER (5 minutes)
#    - Go to https://dashboard.render.com
#    - Sign up (free) â†’ Connect GitHub â†’ Select this repository
#    - Click "New" â†’ "Web Service" (NOT Blueprint - avoids payment wall!)
#    - Choose "Build and deploy from Git repository"
#    - Connect this repository
#    - IMPORTANT: Create TWO separate services manually
#
# ðŸŽ¯ STEP 3A: CREATE FRONTEND SERVICE
#    - Service Name: socialflow-frontend
#    - Root Directory: (leave empty)
#    - Environment: Static Site
#    - Build Command: npm install && npm run build
#    - Publish Directory: dist
#    - Add Environment Variable: VITE_API_URL = https://socialflow-backend.onrender.com
#
# ðŸŽ¯ STEP 3B: CREATE BACKEND SERVICE  
#    - Service Name: socialflow-backend
#    - Root Directory: backend
#    - Environment: Node
#    - Build Command: npm install && npx prisma generate
#    - Start Command: npx prisma migrate deploy && npm start
#    - Add Environment Variables (copy from this file's envVars section)
#
# ðŸŽ¯ STEP 4: SET REQUIRED VARIABLES (2 minutes)
#    Go to backend service â†’ Environment tab â†’ Add:
#    - DATABASE_URL = your_neon_connection_string (from Step 1)
#    - All other variables can be added later when needed
#
# âœ… RESULT: Both services deploy on FREE plan!
#    - Frontend: https://socialflow-frontend.onrender.com  
#    - Backend: https://socialflow-backend.onrender.com
#
# ðŸ”‘ Generate JWT Secret:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
#
# ðŸŽ¯ Total Time: ~10 minutes for full deployment!
#
# ðŸ“ˆ ADD FEATURES LATER:
# - Instagram: Add FACEBOOK_APP_ID and FACEBOOK_APP_SECRET for OAuth
#   * Create Facebook App: https://developers.facebook.com/apps/
#   * Each user connects their own Instagram via OAuth
# - AI Content: Add OPENAI_API_KEY or HF_TOKEN in Environment tab
# - File Uploads: Add CLOUDINARY_API_SECRET in Environment tab
# - Email: Add SMTP credentials
#
# ðŸ”„ TO UPDATE ENVIRONMENT VARIABLES:
# 1. Go to Render Dashboard â†’ Your Service â†’ Environment
# 2. Find the variable â†’ Click "Edit" â†’ Add value â†’ Save
# 3. Service will automatically restart with new variables
#
# ðŸ‘¥ MULTI-USER INSTAGRAM:
# - Users connect via: POST /api/instagram/connect (requires auth)
# - Each user's Instagram tokens stored in database (SocialAccount model)
# - No global Instagram token needed!
#
# ðŸ†˜ TROUBLESHOOTING:
# - Check logs in Render dashboard
# - Verify environment variables are set
# - Test database connection
# - Ensure both services show "Live" status